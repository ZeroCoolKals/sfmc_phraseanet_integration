<script runat="server">
    Platform.Load("core", "1");

    var end_point = "";
    var accessToken = "";
    var categories_path = "asset/v1/content/categories/?$pagesize=20";
    var contentType = 'application/json';
    var token_lifetime = 0;

    function auth() {
        var authEndpoint = 'https://mcc2gk-bp085x9503lcvgdlxx944.auth.marketingcloudapis.com';
        var url
            = authEndpoint + '/v2/token';

        var payload = {
            client_id: "6jbz9ag4cdwumfc6x4s7fcjx",
            client_secret: "Z5b6GIstJzY5BcuLKp9UcAEC",
            grant_type: "client_credentials"
        };

        try {
            var accessTokenRequest = HTTP.Post(url, contentType, Stringify(payload));

            if (accessTokenRequest.StatusCode == 200) {
                var response_body = Platform.Function.ParseJSON(accessTokenRequest.Response[0]);
                accessToken = response_body.access_token;
                end_point = response_body.rest_instance_url;
                token_lifetime = response_body.expires_in;
            }
        } catch (error) {
            // Write(Stringify(error));
        }

    }

    function getCategories() {
        auth();
        var headerNames = ["Authorization"];
        var headerValues = ["Bearer " + accessToken];
        var requestUrl = end_point + categories_path;
        try {
            var response = HTTP.Get(requestUrl, headerNames, headerValues);
            var content =  Platform.Function.ParseJSON(response.Content)
            //Write(Stringify(content.items));
           Variable.SetValue("@data", Stringify(content.items));

        } catch (error) {
            Write(Stringify(error));
        }
    }
    getCategories();

</script>
